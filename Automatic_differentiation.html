<!DOCTYPE html>
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2&nbsp;Automatic differentiation</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript">
(function() {
  document.write('<link rel="stylesheet" href="katex/katex.min.css" />');
})();(function() {document.write('<scr' + 'ipt type="text/javascript" src="katex/katex.min.js"></scr' + 'ipt>');})();(function(f) {
  // A "simple" onLoad function
  if (window.document.readyState == "complete") {
    f();
  } else if (window.document.addEventListener) {
    window.document.addEventListener("DOMContentLoaded", f, false);
  } else if (window.attachEvent) {
    window.attachEvent("onreadystatechange", function() {
      if (window.document.readyState == "complete") {
        f();
      }
    });
  } else {
    var oldLoad = window.onload;
    if (typeof(oldLoad) == "function") {
      window.onload = function() {
        try {
          oldLoad();
        } finally {
          f();
        }
      };
    } else {
      window.onload = f;
    }
  }
})(function() {
  // This is an ugly way to change the doctype, in case the scribble document
  // did not use (with-html5).
  if (!(document.doctype && document.doctype.publicId == '')) {
    if (console && console.log) {
      console.log("Re-wrote the document to use the HTML5 doctype.\n"
                  + "  Consider using the following declaration:\n"
                  + "      @title[#:style (with-html5 manual-doc-style)]{â€¦}");
    }
    var wholeDoc = '<!doctype HTML>\n' + document.documentElement.outerHTML;
    document.open();
    document.clear();
    document.write(wholeDoc);
  }
  var inlineElements = document.getElementsByClassName("texMathInline");
  for (var i = 0; i < inlineElements.length; i++) {
    var e = inlineElements[i];
    katex.render(e.textContent, e, { displayMode:false, throwOnError:false });
  }
  var displayElements = document.getElementsByClassName("texMathDisplay");
  for (var i = 0; i < displayElements.length; i++) {
    var e = displayElements[i];
    katex.render(e.textContent, e, { displayMode:true, throwOnError:false });
  }
});
</script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Rackpropagator:<span class="mywbr"> &nbsp;</span> Reverse-<wbr></wbr>mode automatic differentiation of Racket programs</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Supported_Language.html" class="tocviewlink" data-pltdoc="x">Supported Language</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Automatic differentiation</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Linear_generic_interface.html" class="tocviewlink" data-pltdoc="x">Linear generic interface</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Registering_primitives.html" class="tocviewlink" data-pltdoc="x">Registering primitives</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="A-Normal_Form.html" class="tocviewlink" data-pltdoc="x">A-<wbr></wbr>Normal Form</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Limitations.html" class="tocviewlink" data-pltdoc="x">Limitations</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>2&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Automatic differentiation</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="#%28part._.Background%29" class="tocviewlink" data-pltdoc="x">Background</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="#%28part._.Reverse_transform_.A.P.I%29" class="tocviewlink" data-pltdoc="x">Reverse transform API</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Background%29" class="tocsubseclink" data-pltdoc="x">Background</a></td></tr><tr><td><span class="tocsublinknumber">2.1.1<tt>&nbsp;</tt></span><a href="#%28part._.Derivatives%29" class="tocsubseclink" data-pltdoc="x">Derivatives</a></td></tr><tr><td><span class="tocsublinknumber">2.1.2<tt>&nbsp;</tt></span><a href="#%28part._.Composition_and_the_chain_rule%29" class="tocsubseclink" data-pltdoc="x">Composition and the chain rule</a></td></tr><tr><td><span class="tocsublinknumber">2.1.3<tt>&nbsp;</tt></span><a href="#%28part._.The_reverse_transform%29" class="tocsubseclink" data-pltdoc="x">The reverse transform</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.Reverse_transform_.A.P.I%29" class="tocsubseclink" data-pltdoc="x">Reverse transform API</a></td></tr><tr><td><span class="tocsublinknumber">2.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Specifying_reverse_transformations%29" class="tocsubseclink" data-pltdoc="x">Specifying reverse transformations</a></td></tr><tr><td><span class="tocsublinknumber">2.2.2<tt>&nbsp;</tt></span><a href="#%28part._.Interface%29" class="tocsubseclink" data-pltdoc="x">Interface</a></td></tr><tr><td><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">grad</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._~e2~88~87%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">&#8711;</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad1%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">grad1</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">D</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">D+</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._lift%2F.D%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">lift/<span class="mywbr"> &nbsp;</span>D+</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._define%2F.D%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define/<span class="mywbr"> &nbsp;</span>D+</span></span></a></td></tr><tr><td><span class="tocsublinknumber">2.2.3<tt>&nbsp;</tt></span><a href="#%28part._.Reverse-transformed_procedure_results%29" class="tocsubseclink" data-pltdoc="x">Reverse-<wbr></wbr>transformed procedure results</a></td></tr><tr><td><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._proc-result%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">proc-<wbr></wbr>result</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._primal%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">primal</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._backprop%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">backprop</span></span></a></td></tr><tr><td><span class="tocsublinknumber">2.2.4<tt>&nbsp;</tt></span><a href="#%28part._.Handling_functions_unknown_as_primitives%29" class="tocsubseclink" data-pltdoc="x">Handling functions unknown as primitives</a></td></tr><tr><td><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._current-unknown-transform%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">current-<wbr></wbr>unknown-<wbr></wbr>transform</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-unknown-transform%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">error-<wbr></wbr>unknown-<wbr></wbr>transform</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-unknown-proc-transform%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">error-<wbr></wbr>unknown-<wbr></wbr>proc-<wbr></wbr>transform</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-non-zero-sensitivity-transform%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">error-<wbr></wbr>non-<wbr></wbr>zero-<wbr></wbr>sensitivity-<wbr></wbr>transform</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.3</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Supported_Language.html" title="backward to &quot;1 Supported Language&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Rackpropagator: Reverse-mode automatic differentiation of Racket programs&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Linear_generic_interface.html" title="forward to &quot;3 Linear generic interface&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>2<tt>&nbsp;</tt><a name="(part._.Automatic_differentiation)"></a>Automatic differentiation</h3><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Background%29" class="toclink" data-pltdoc="x">2.1<span class="hspace">&nbsp;</span>Background</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Derivatives%29" class="toclink" data-pltdoc="x">2.1.1<span class="hspace">&nbsp;</span>Derivatives</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Composition_and_the_chain_rule%29" class="toclink" data-pltdoc="x">2.1.2<span class="hspace">&nbsp;</span>Composition and the chain rule</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.The_reverse_transform%29" class="toclink" data-pltdoc="x">2.1.3<span class="hspace">&nbsp;</span>The reverse transform</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Reverse_transform_.A.P.I%29" class="toclink" data-pltdoc="x">2.2<span class="hspace">&nbsp;</span>Reverse transform API</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Specifying_reverse_transformations%29" class="toclink" data-pltdoc="x">2.2.1<span class="hspace">&nbsp;</span>Specifying reverse transformations</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Interface%29" class="toclink" data-pltdoc="x">2.2.2<span class="hspace">&nbsp;</span>Interface</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Reverse-transformed_procedure_results%29" class="toclink" data-pltdoc="x">2.2.3<span class="hspace">&nbsp;</span>Reverse-transformed procedure results</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Handling_functions_unknown_as_primitives%29" class="toclink" data-pltdoc="x">2.2.4<span class="hspace">&nbsp;</span>Handling functions unknown as primitives</a></p></td></tr></table><p></p><p>This section first give some general background on reverse-mode
automatic differentiation, and then describes the interface provided
by this library.  The implementation is largely based on
<span class="Autobibref"><a href="doc-bibliography.html#%28autobib._.B..._.A..._.Pearlmutter._and._.J..._.M..._.Siskind.Reverse-mode._.A.D._in._a._functional._framework~3a._.Lambda._the._ultimate._backpropagator.A.C.M._.Trans..._.Program..._.Lang..._.Syst..._30%282%29%2C._pp..._1--362008https~3a%2F%2Fdoi..org%2F10..1145%2F1330017..1330018%29" class="AutobibLink" data-pltdoc="x">Pearlmutter and Siskind</a>&nbsp;(<a href="doc-bibliography.html#%28autobib._.B..._.A..._.Pearlmutter._and._.J..._.M..._.Siskind.Reverse-mode._.A.D._in._a._functional._framework~3a._.Lambda._the._ultimate._backpropagator.A.C.M._.Trans..._.Program..._.Lang..._.Syst..._30%282%29%2C._pp..._1--362008https~3a%2F%2Fdoi..org%2F10..1145%2F1330017..1330018%29" class="AutobibLink" data-pltdoc="x">2008</a>)</span>.</p><h4>2.1<tt>&nbsp;</tt><a name="(part._.Background)"></a>Background</h4><h5>2.1.1<tt>&nbsp;</tt><a name="(part._.Derivatives)"></a>Derivatives</h5><p>This section contains a brief recap of differentiation&#8212;<wbr></wbr>before we get
to <span class="emph">automatic</span> differentiation. It largely follows the
introductory sections of <span class="Autobibref"><a href="doc-bibliography.html#%28autobib._.Conal._.Elliot.The._simple._essence._of._automatic._differentiation.In._.Proc..._.A.C.M._.Program..._.Lang..%2C._.I.C.F.P._volume._22018https~3a%2F%2Fdoi..org%2F10..1145%2F3236765%29" class="AutobibLink" data-pltdoc="x">Elliot</a>&nbsp;(<a href="doc-bibliography.html#%28autobib._.Conal._.Elliot.The._simple._essence._of._automatic._differentiation.In._.Proc..._.A.C.M._.Program..._.Lang..%2C._.I.C.F.P._volume._22018https~3a%2F%2Fdoi..org%2F10..1145%2F3236765%29" class="AutobibLink" data-pltdoc="x">2018</a>)</span>.</p><p>Suppose <span class="texMathInline">A</span> and <span class="texMathInline">B</span> are finite-dimensional vector spaces, and that
we have a function</p><p><span class="texMathDisplay">f : A \to B.</span></p><p>The derivative of <span class="texMathInline">f</span> (if it exists) is a map</p><p><span class="texMathDisplay">df : A \to A \to B</span></p><p>associating a linear map from <span class="texMathInline">A</span> to <span class="texMathInline">B</span> with each element of
<span class="texMathInline">A</span>.  We say that <span class="texMathInline">df(x)</span> is the derivative of <span class="texMathInline">f</span> at the point
<span class="texMathInline">x</span>.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>You may be used to thinking of a derivative as a number, perhaps
written <span class="texMathInline">\frac{df}{dx}</span> or <span class="texMathInline">f^\prime(x)</span>, or as a matrix <span class="texMathInline">J_{ij}
= \frac{\partial f_i}{\partial x_j}</span>.  This presentation is
equivalent, but will have several advantages for our purposes.</p></blockquote></blockquote></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>For example if <span class="texMathInline">f(x) = 5x</span>, the derivative (as defined above) of
<span class="texMathInline">f</span> is the linear map</p><p><span class="texMathDisplay">df(x) = \Delta x \mapsto 5 \Delta x,</span></p><p>and we understand notation such as <span class="texMathInline">\frac{df}{dx} = 5</span> to indicate
the coefficients of this map.</p></blockquote></blockquote></blockquote><p>Sometimes it is convenient to choose bases for <span class="texMathInline">A</span> and <span class="texMathInline">B</span>, and
represent this linear map as a matrix (which is then known as the
<span class="emph">Jacobian</span>), but sometimes another representation is preferable.</p><p>We will keep the representation of linear maps as functions.
Eventually, just as we think of a (mathematical) function <span class="texMathInline">f</span> being
implemented (or approximated by) a Racket function, its derivative
will be a Racket function too.</p><p>It is often necessary, eventually, to turn this function into a
numerical representation.  Evaluating the linear map gives a
<span class="emph">directional derivative</span> (in terms of Jacobians, this would be a
Jacobian-vector product).  Evaluating it for each element of a basis
of <span class="texMathInline">A</span> allows us to reconstruct the whole Jacobian.  Notice that to
reconstruct the Jacobian of <span class="texMathInline">f</span> at <span class="texMathInline">x</span> we would need to make
<span class="texMathInline">\dim{A}</span> evaluations of <span class="texMathInline">df(x)</span>, regardless of the dimensionality
of <span class="texMathInline">B</span>.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p><span style="font-weight: bold">Example</span></p><p><span class="texMathDisplay">f : \mathbf{R}^3 \to \mathbf{R}^2 \\
f(x,y,z) = (z + 1, xy)</span></p><p>then</p><p><span class="texMathDisplay">\begin{split}
d&amp;f(x,y,z) =\\
 &amp;(\Delta x, \Delta y, \Delta z) \mapsto (\Delta z, y \Delta x + x \Delta y)
\end{split}</span></p><p>The directional derivative, in the direction <span class="texMathInline">(1,0,0)</span>, is</p><p><span class="texMathDisplay">df(x,y,z)(1,0,0) = (0,y)</span></p><p>Evaluating the map at the standard basis vectors <span class="texMathInline">(1,0,0)</span>,
<span class="texMathInline">(0,1,0)</span> and <span class="texMathInline">(0,0,1)</span> gives the Jacobian matrix:</p><p><span class="texMathDisplay">\begin{pmatrix}

0 &amp; 0 &amp; 1 \\
y &amp; x &amp; 0

\end{pmatrix}</span></p><p>The adjoint map is</p><p><span class="texMathDisplay">\begin{split}
D&amp;f(x,y,z) =\\
 &amp;(\Delta u, \Delta v) \mapsto (y\Delta v, x\Delta v, \Delta u)
\end{split}</span></p><p>where <span class="texMathInline">\Delta u</span> and <span class="texMathInline">\Delta v</span> are sometimes known as
<a name="(tech._sensitivity._variable)"></a><span style="font-style: italic">sensitivity variables</span>.  The function is said to map
<span class="emph">output</span> or <a name="(tech._result._sensitivity)"></a><span style="font-style: italic">result sensitivities</span> to <a name="(tech._argument._sensitivity)"></a><span style="font-style: italic">argument
sensitivities</span>.</p><p>Notice that it takes just two evaluations of the adjoint map, at
<span class="texMathInline">(1,0)</span> and <span class="texMathInline">(0,1)</span>, to obtain the same Jacobian as above, at a
cost of two multiplications per evaluation in each case.</p></blockquote></blockquote></blockquote><p>A case that is often useful in practice is when <span class="texMathInline">A</span> is very high
dimensional, and <span class="texMathInline">B</span> is <span class="texMathInline">\mathbf{R}</span>. Loss functions in
optimization problems have this form, for example.</p><p>Handling this case more efficiently is the motivation for
<span class="emph">reverse-mode</span> AD, which is based on the following idea.</p><p>If we further insist that <span class="texMathInline">A</span> and <span class="texMathInline">B</span> are both equipped with an
inner product, we can obtain the <span class="emph">adjoint</span> of a linear map <span class="texMathInline">L :
A \to B</span>, which is another linear map <span class="texMathInline">L^* : B \to A</span>.  This allows
us to define</p><p><span class="texMathDisplay">Df : A \to B \to A\\
Df(x) = df(x)^*.</span></p><p>If <span class="texMathInline">df(x)</span> can be represented by the Jacobian matrix <span class="texMathInline">J</span>, then the
matrix representation of <span class="texMathInline">Df(x)</span> is the <span class="emph">transpose</span> of the
Jacobian, <span class="texMathInline">J^T</span>.</p><p>Particularly when referring to its implementation in code, we call
<span class="texMathInline">Df(x)</span> the <span class="emph">backpropagator</span> of <span class="texMathInline">f</span> at <span class="texMathInline">x</span>.</p><p>Returning to the case we considered above, of <span class="texMathInline">f : A \to
\mathbf{R}</span>, it would be possible to reconstruct the Jacobian from a
single evaluation of the linear map <span class="texMathInline">Df(x) : \mathbf{R} \to A</span>.</p><p>The <a name="(tech._gradient)"></a><span style="font-style: italic">gradient</span> of <span class="texMathInline">f</span> is</p><p><span class="texMathDisplay">\nabla f : A \to A\\
\nabla f(x) = Df(x)(1)</span></p><p>assuming the usual inner product on <span style="font-weight: bold">R</span>.</p><h5>2.1.2<tt>&nbsp;</tt><a name="(part._.Composition_and_the_chain_rule)"></a>Composition and the chain rule</h5><p>Our goal is to be able to differentiate as many (Racket) functions as
possible.  In some cases, we will be content with explicitly providing
a function <span class="RktSym">Df</span> that computes the derivative of another
function <span class="RktSym">f</span>, and associating them somehow.  It would be
unsatisfactory if we had to do this for every <span class="RktSym">f</span>, though, so we
seek a way of determining the derivative of a function, from its
definition in terms of other functions.  The ability to do this is the
main selling point of of automatic differentiation.  The primary way
(and in some sense, the only way) that this is achieved is via the
chain rule.</p><p>The <a name="(tech._chain._rule)"></a><span style="font-style: italic">chain rule</span> allows derivatives of compositions of
functions to be related to compositions of their derivatives.  The
chain rule can be expressed in terms of <span class="texMathInline">d</span> or <span class="texMathInline">D</span>:</p><p><span class="texMathDisplay">d(g \circ f)(x) = dg(f(x)) \circ df(x)</span></p><p><span class="texMathDisplay">D(g \circ f)(x) = Df(x) \circ Dg(f(x)).</span></p><p>Notice the &lsquo;reverse&rsquo; order of composition in the right hand side of
the equation immediately above.</p><p><span class="refelem"><span class="refcolumn"><span class="refcontent">We will focus on <span class="texMathInline">D</span> for the rest of the section, but
similar considerations would apply to <span class="texMathInline">d</span>.</span></span></span>  Notice too that for
both rules, we need to know <span class="texMathInline">f(x)</span> to express the derivative of the
composition (not merely <span class="texMathInline">Df</span>).  There is often some shared work
involved in computing <span class="texMathInline">Df(x)</span> and <span class="texMathInline">f(x)</span>, but this is not apparent
from the usual chain rule, and an interface based on this would not
let us take advantage of it.</p><p>Instead, define</p><p><span class="texMathDisplay">D^+f(x) = (f(x), Df(x))</span></p><p>and now</p><p><span class="texMathDisplay">D^+(g\circ f)(x) = \big(g(f(x)), Df(x) \circ Dg(f(x))\big).</span></p><p>Notice that <span class="texMathInline">D^+(g\circ f)</span> can now be expressed in terms of
<span class="texMathInline">D^+g</span> and <span class="texMathInline">D^+f</span>.</p><h5>2.1.3<tt>&nbsp;</tt><a name="(part._.The_reverse_transform)"></a>The reverse transform</h5><p>The mapping</p><p><span class="texMathDisplay">f \mapsto D^+f</span></p><p>as implemented in code is the central operation of reverse-mode AD.</p><p>Why <span class="emph">reverse</span> transform?</p><p>Notice the composition rule above: Roughly, whereas data flows
&lsquo;forwards&rsquo; through the composition <span class="texMathInline">g \circ f</span>, the derivatives of
<span class="texMathInline">f</span> and <span class="texMathInline">g</span> are composed in the opposite order, and so data flows
&lsquo;in reverse&rsquo; through them.</p><p><span class="refelem"><span class="refcolumn"><span class="refcontent">TODO a picture would help here!</span></span></span> Since the output of the
reverse transform combines the function value and its derivative, data
must in fact flow <span class="emph">both</span> ways.  The idea is to store each
function evaluation on the way &lsquo;forward&rsquo;, to be consumed by the
appropriate derivative computation on the way back again.</p><p>This description is far from complete.  Handling variable assignment
(and repeated use of a variable) as well as mutable state have been
omitted, as have many technical details needed for a practical
implementation.</p><h4>2.2<tt>&nbsp;</tt><a name="(part._.Reverse_transform_.A.P.I)"></a>Reverse transform API</h4><p>The previous section defined the reverse transformation as a mapping
<span class="texMathInline">f \mapsto D^+ f</span>.  This section describes how it applies to Racket
code. The macros <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%2B%29%29" class="RktStxLink" data-pltdoc="x">D+</a></span> and <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._lift%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">lift/D+</a></span> perform
transformations <span class="emph">similar</span> to this one; <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%29%29" class="RktStxLink" data-pltdoc="x">D</a></span> and
<span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="RktStxLink" data-pltdoc="x">grad</a></span> are provided as a convenience. Of these,
<span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._lift%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">lift/D+</a></span> is fundamental.</p><p>When differentiating an expression, each procedure that is encountered
is replaced with one that computes both the <a name="(tech._primal)"></a><span style="font-style: italic">primal</span>&#8212;<wbr></wbr>the
undifferentiated function value, and a <a name="(tech._backpropagator)"></a><span style="font-style: italic">backpropagator</span>&#8212;<wbr></wbr>a
linear function taking an output sensitivity and returning the
argument sensitivities, called when computing derivative values.  The
process of replacing the function with its primal and backpropagator
is known as <a name="(tech._reverse._transformation)"></a><span style="font-style: italic">reverse transformation</span>.</p><p>In the example below, the reverse transformation of <span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span> is
obtained with <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._lift%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">lift/D+</a></span>.  The primal and backpropagator are
returned in a <span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._proc-result%29%29" class="RktValLink" data-pltdoc="x">proc-result</a></span> struct.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._lift%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">lift/D+</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">4.0</span><span class="hspace">&nbsp;</span><span class="RktVal">2.5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._primal%29%29" class="RktValLink" data-pltdoc="x">primal</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">10.0</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._backprop%29%29" class="RktValLink" data-pltdoc="x">backprop</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#&lt;procedure:...ator/primitives.rkt:87:2&gt;</span></p></td></tr></table></blockquote><p>Procedures whose definitions occur within the expression being
differentiated can be transformed automatically by the library.  Any
procedure that is used but not defined within the expression must also
be replaced with its reverse transform.  Such procedures are known as
<a name="(tech._primitive)"></a><span style="font-style: italic">primitives</span>, and include, for example, arithmetic operations.
They must have backpropagators that are known in advance.</p><p>In this library, the backpropagator of a function takes two arguments:
the <a href="#%28tech._result._sensitivity%29" class="techoutside" data-pltdoc="x"><span class="techinside">result sensitivity</span></a>, which should <a href="Linear_generic_interface.html#%28tech._conform%29" class="techoutside" data-pltdoc="x"><span class="techinside">conform</span></a> to the
value returned by the function, and the <a href="#%28tech._box._sensitivity%29" class="techoutside" data-pltdoc="x"><span class="techinside">box sensitivities</span></a>,
which will be explained below.  The result of evaluating a
backpropagator is a list containing</p><ul><li><p>A list of the sensitivities of the closed-over variables in the
function (in an unspecified order)</p></li><li><p>The <a href="#%28tech._argument._sensitivity%29" class="techoutside" data-pltdoc="x"><span class="techinside">argument sensitivity</span></a> for each argument passed to the
function.</p></li></ul><p>The <a name="(tech._box._sensitivity)"></a><span style="font-style: italic">box sensitivity</span> argument to a backpropagator is the way
sensitivities of mutable data structures are handled.  This is a hash
table (satisfying <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._and%2Fc%29%29" class="RktValLink" data-pltdoc="x">and/c</a></span><span class="stt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash~3f%29%29" class="RktValLink" data-pltdoc="x">hash?</a></span><span class="stt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-eq~3f%29%29" class="RktValLink" data-pltdoc="x">hash-eq?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="stt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._immutable~3f%29%29" class="RktValLink" data-pltdoc="x">immutable?</a></span><span class="RktPn">)</span><span class="RktPn">)</span>)
mapping a mutable data structure to its corresponding sensitivity
value.  The value in the hash table with a given mutable data
structure as its key can be updated by the backpropagator of a
function that refers to an element of the data structure.</p><p><div class="SIntrapara">Continuing the example above,
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._backprop%29%29" class="RktValLink" data-pltdoc="x">backprop</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1.0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._make-hasheq%29%29" class="RktValLink" data-pltdoc="x">make-hasheq</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(() 2.5 4.0)</span></p></td></tr></table></blockquote></div></p><p>Notice the empty hash table passed as the second argument, and the
first element of the resulting list, with a list of closed-over
variable sensitivities (in this case there are none, so the list is
empty).</p><p>Alternatively, use <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%2B%29%29" class="RktStxLink" data-pltdoc="x">D+</a></span> to avoid the empty
hash table argument, and to drop the closure sensitivities:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%2B%29%29" class="RktStxLink" data-pltdoc="x">D+</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">4.0</span><span class="hspace">&nbsp;</span><span class="RktVal">2.5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._primal%29%29" class="RktValLink" data-pltdoc="x">primal</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">10.0</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._backprop%29%29" class="RktValLink" data-pltdoc="x">backprop</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1.0</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(2.5 4.0)</span></p></td></tr></table></blockquote><h5>2.2.1<tt>&nbsp;</tt><a name="(part._.Specifying_reverse_transformations)"></a>Specifying reverse transformations</h5><p>When specifying a reverse transform, it should have the form described
above (as returned by <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._lift%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">lift/D+</a></span>).  Here is the reverse
transformation of two-argument multiplication:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._proc-result%29%29" class="RktValLink" data-pltdoc="x">proc-result</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">Aw</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Abox</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="Linear_generic_interface.html#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._scale%29%29" class="RktValLink" data-pltdoc="x">scale</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Aw</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="Linear_generic_interface.html#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._scale%29%29" class="RktValLink" data-pltdoc="x">scale</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Aw</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>and of <span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._exp%29%29" class="RktValLink" data-pltdoc="x">exp</a></span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">exp-x</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._exp%29%29" class="RktValLink" data-pltdoc="x">exp</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._proc-result%29%29" class="RktValLink" data-pltdoc="x">proc-result</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">exp-x</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">Aw</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Abox</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="Linear_generic_interface.html#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._scale%29%29" class="RktValLink" data-pltdoc="x">scale</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Aw</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">exp-x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Backpropagator definitions should allow for the fact that the result
sensitivity may be passed a value of <span class="RktSym"><a href="Linear_generic_interface.html#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._gen-zero%29%29" class="RktValLink" data-pltdoc="x">gen-zero</a></span> (hence the use
of <span class="RktSym"><a href="Linear_generic_interface.html#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._scale%29%29" class="RktValLink" data-pltdoc="x">scale</a></span>).  See <a href="Linear_generic_interface.html" data-pltdoc="x">Linear generic interface</a>.</p><p>The reverse transform of a binding must be provided when registering a
binding as a new primitive with <span class="RktSym"><a href="Registering_primitives.html#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._register-primitive%21%29%29" class="RktStxLink" data-pltdoc="x">register-primitive!</a></span>, or by
the <span class="RktSym"><a href="Registering_primitives.html#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._require%2Fprimal%2Bbackprop%29%29" class="RktStxLink" data-pltdoc="x">require/primal+backprop</a></span> mechanism.  It can subsequently
be used in functions defined with <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._define%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">define/D+</a></span>.</p><h5>2.2.2<tt>&nbsp;</tt><a name="(part._.Interface)"></a>Interface</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._rackpropagator/main..rkt)._grad))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">grad</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A function that evaluates to the gradient of <span class="RktVar">expr</span> at the given
arguments.</div></p><p>The result of evaluating <span class="RktVar">expr</span> must be a procedure.</p><p>This form evaluates to a function of the same arity, that when called
returns the gradient (represented as described above)&#8212;<wbr></wbr>in general, it
will be a list whose length is the number of arguments passed, and
whose elements <a href="Linear_generic_interface.html#%28tech._conform%29" class="techoutside" data-pltdoc="x"><span class="techinside">conform</span></a> with the corresponding arguments.</p><p>The first form is equivalent to the second with <span class="RktVal">1.0</span> passed as
the value of <span class="RktSym">result-sensitivity</span>.</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="RktStxLink" data-pltdoc="x">grad</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktVal">3.0</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(4.0 1.0)</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._rackpropagator/main..rkt)._~e2~88~87))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._~e2~88~87%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">&#8711;</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">The same as <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="RktStxLink" data-pltdoc="x">grad</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._rackpropagator/main..rkt)._grad1))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad1%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">grad1</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="RktStxLink" data-pltdoc="x">grad</a></span>, but for functions of arity one. When <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="RktStxLink" data-pltdoc="x">grad</a></span>
would evaluate to a list holding a single element, this form evaluates
to the element without the list wrapper, which may be more convenient.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad1%29%29" class="RktStxLink" data-pltdoc="x">grad1</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad1%29%29" class="RktStxLink" data-pltdoc="x">grad1</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._cos%29%29" class="RktValLink" data-pltdoc="x">cos</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0.0</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-1.0</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._rackpropagator/main..rkt)._.D))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">D</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%2B%29%29" class="RktStxLink" data-pltdoc="x">D+</a></span>, except the resulting function returns only the
backpropagator.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._define%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">define/D+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-~3eimmutable-vector%29%29" class="RktValLink" data-pltdoc="x">vector-&gt;immutable-vector</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector%29%29" class="RktValLink" data-pltdoc="x">vector</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%29%29" class="RktStxLink" data-pltdoc="x">D</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktVal">3.0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">1.0</span><span class="hspace">&nbsp;</span><span class="RktVal">0.0</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(4.0 0.0)</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">An error: sensitivity does not conform with the result:</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%29%29" class="RktStxLink" data-pltdoc="x">D</a></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktVal">3.0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1.0</span><span class="hspace">&nbsp;</span><span class="RktVal">0.0</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">raise-argument-error: contract violation</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">expected: exact-nonnegative-integer?</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">given: '(1.0 0.0)</span></p></td></tr></table></blockquote></div></p><p><span class="refelem"><span class="refcolumn"><span class="refcontent">TODO Fix unhelpful error message</span></span></span></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._rackpropagator/main..rkt)._.D+))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._.D%2B%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">D+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._lift%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">lift/D+</a></span>, except that:</div></p><ul><li><p>The backpropagator in the result is partially applied in its second
argument to a new empty hash table for holding the sensitivities of
mutable values</p></li><li><p>The result of evaluating the backpropagator contains <span class="emph">only</span>
the argument sensitivities (and not the sensitivies of any closed-over
variables).</p></li></ul><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._rackpropagator/main..rkt)._lift/.D+))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._lift%2F.D%2B%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">lift/D+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Reverse transform the expression <span class="RktVar">expr</span>.  The result is a
function, that when called returns a <span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._proc-result%29%29" class="RktValLink" data-pltdoc="x">proc-result</a></span> struct
containing the primal at the given arguments, and a backpropagator for
the same arguments.</div></p><p>The backpropagator is the two argument form described
<a href="#%28part._.Reverse_transform_.A.P.I%29" data-pltdoc="x">above</a>.  The first argument is the
result sensitivity, and the second must be a mutable hash table
(satisfying <span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._and%2Fc%29%29" class="RktValLink" data-pltdoc="x">and/c</a></span><span class="stt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash~3f%29%29" class="RktValLink" data-pltdoc="x">hash?</a></span><span class="stt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-eq~3f%29%29" class="RktValLink" data-pltdoc="x">hash-eq?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._not%2Fc%29%29" class="RktValLink" data-pltdoc="x">not/c</a></span><span class="stt"> </span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._immutable~3f%29%29" class="RktValLink" data-pltdoc="x">immutable?</a></span><span class="RktPn">)</span><span class="RktPn">)</span>).</p><p>The resulting function is of the correct form to pass to derivatives
of higher-order functions.</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="RktStxLink" data-pltdoc="x">grad</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._foldl%29%29" class="RktValLink" data-pltdoc="x">foldl</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._lift%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">lift/D+</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(() 24.0 (12.0 8.0 6.0))</span></p></td></tr></table></blockquote></div></p><p>Using it directly:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">D+f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._lift%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">lift/D+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" class="RktStxLink" data-pltdoc="x">set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">D+f</span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._primal%29%29" class="RktValLink" data-pltdoc="x">primal</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">4.0</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._backprop%29%29" class="RktValLink" data-pltdoc="x">backprop</a></span><span class="hspace">&nbsp;</span><span class="RktSym">result</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1.0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._make-hasheq%29%29" class="RktValLink" data-pltdoc="x">make-hasheq</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(() 4.0)</span></p></td></tr></table></blockquote><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._rackpropagator/main..rkt)._define/.D+))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._define%2F.D%2B%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define/D+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._define%2F.D%2B%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define/D+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktVar">args</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktVar">rest-args</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...+</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Define a new primitive in terms of others.</div></p><p>Similarly to define <span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span>, bind <span class="RktVar">id</span> to the result of
evaluating <span class="RktVar">expr</span> in the first case, or to a procedure in the
second case&#8212;<wbr></wbr>note that this form does not support the curried
function definition shorthand of <span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span>.</p><p>In addition, the reverse transform of <span class="RktVar">expr</span> or <span class="RktVar">body</span>
is determined, and <span class="RktVar">id</span> registered as a primitive.  Recursive
definitions are allowed.</p><h5>2.2.3<tt>&nbsp;</tt><a name="(part._.Reverse-transformed_procedure_results)"></a>Reverse-transformed procedure results</h5><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><table cellspacing="0" cellpadding="0" class="RForeground"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span></td><td><span class="hspace">&nbsp;</span></td><td><a name="(def._((lib._rackpropagator/main..rkt)._proc-result-backprop))"></a><a name="(def._((lib._rackpropagator/main..rkt)._proc-result-primal))"></a><a name="(def._((lib._rackpropagator/main..rkt)._proc-result~3f))"></a><a name="(def._((lib._rackpropagator/main..rkt)._struct~3aproc-result))"></a><a name="(def._((lib._rackpropagator/main..rkt)._proc-result))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._proc-result%29%29" class="RktValDef RktValLink" data-pltdoc="x">proc-result</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">primal</span><span class="stt"> </span><span class="RktSym">backprop</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">primal</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">backprop</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28quote._~23~25kernel%29._procedure~3f%29%29" class="RktValLink" data-pltdoc="x">procedure?</a></span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._rackpropagator/main..rkt)._primal))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._primal%29%29" class="RktValDef RktValLink" data-pltdoc="x">primal</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">r</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">r</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._proc-result~3f%29%29" class="RktValLink" data-pltdoc="x">proc-result?</a></span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._rackpropagator/main..rkt)._backprop))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._backprop%29%29" class="RktValDef RktValLink" data-pltdoc="x">backprop</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">r</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28quote._~23~25kernel%29._procedure~3f%29%29" class="RktValLink" data-pltdoc="x">procedure?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">r</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._proc-result~3f%29%29" class="RktValLink" data-pltdoc="x">proc-result?</a></span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">A two member structure for holding the return value of a
reverse-transformed procedure.</div></p><p><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._proc-result-primal%29%29" class="RktValLink" data-pltdoc="x">proc-result-primal</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._proc-result-backprop%29%29" class="RktValLink" data-pltdoc="x">proc-result-backprop</a></span> are also
provided under the shorter aliases <span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._primal%29%29" class="RktValLink" data-pltdoc="x">primal</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._backprop%29%29" class="RktValLink" data-pltdoc="x">backprop</a></span>.</p><h5>2.2.4<tt>&nbsp;</tt><a name="(part._.Handling_functions_unknown_as_primitives)"></a>Handling functions unknown as primitives</h5><p>During reverse transformation, an identifier may be encountered that
is not registered as a primitive. In this case, it is transformed to
the result of calling the procedure stored as the value of the
parameter <span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._current-unknown-transform%29%29" class="RktValLink" data-pltdoc="x">current-unknown-transform</a></span>. In general, the job of
this procedure is to raise an error, but a few other cases where the
result is known may also be handled.</p><p>The default value of <span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._current-unknown-transform%29%29" class="RktValLink" data-pltdoc="x">current-unknown-transform</a></span> is
<span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-non-zero-sensitivity-transform%29%29" class="RktValLink" data-pltdoc="x">error-non-zero-sensitivity-transform</a></span>, that raises an error
only if an attempt is made to call the unknown backpropagator with a
non-zero sensitivity argument.  This permits code paths that do not
contribute to the derivative (e.g. error handling, tests in
conditionals) without having to register (perhaps meaningless)
derivative information for every function that is called.</p><p><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-unknown-transform%29%29" class="RktValLink" data-pltdoc="x">error-unknown-transform</a></span> and
<span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-unknown-proc-transform%29%29" class="RktValLink" data-pltdoc="x">error-unknown-proc-transform</a></span> can be very useful for
debugging.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>parameter</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._rackpropagator/main..rkt)._current-unknown-transform))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._current-unknown-transform%29%29" class="RktValDef RktValLink" data-pltdoc="x">current-unknown-transform</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28quote._~23~25kernel%29._procedure~3f%29%29" class="RktValLink" data-pltdoc="x">procedure?</a></span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._current-unknown-transform%29%29" class="RktValDef RktValLink" data-pltdoc="x">current-unknown-transform</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">proc</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void~3f%29%29" class="RktValLink" data-pltdoc="x">void?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28quote._~23~25kernel%29._procedure~3f%29%29" class="RktValLink" data-pltdoc="x">procedure?</a></span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td valign="top"><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-non-zero-sensitivity-transform%29%29" class="RktValLink" data-pltdoc="x">error-non-zero-sensitivity-transform</a></span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">The reverse transform to apply to a value not registered as a primitive.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._define%2F.D%2B%29%29" class="RktStxLink" data-pltdoc="x">define/D+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car-or-void</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._when%29%29" class="RktStxLink" data-pltdoc="x">when</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._pair~3f%29%29" class="RktValLink" data-pltdoc="x">pair?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._car%29%29" class="RktValLink" data-pltdoc="x">car</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="RktStxLink" data-pltdoc="x">grad</a></span><span class="hspace">&nbsp;</span><span class="RktSym">car-or-void</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1.0</span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktVal">3.0</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((1.0 0.0 0.0))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="RktStxLink" data-pltdoc="x">grad</a></span><span class="hspace">&nbsp;</span><span class="RktSym">car-or-void</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">123.0</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(0.0)</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/parameters.html#%28form._%28%28lib._racket%2Fprivate%2Fmore-scheme..rkt%29._parameterize%29%29" class="RktStxLink" data-pltdoc="x">parameterize</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._current-unknown-transform%29%29" class="RktValLink" data-pltdoc="x">current-unknown-transform</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-unknown-transform%29%29" class="RktValLink" data-pltdoc="x">error-unknown-transform</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._rackpropagator%2Fmain..rkt%29._grad%29%29" class="RktStxLink" data-pltdoc="x">grad</a></span><span class="hspace">&nbsp;</span><span class="RktSym">car-or-void</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1.0</span><span class="hspace">&nbsp;</span><span class="RktVal">2.0</span><span class="hspace">&nbsp;</span><span class="RktVal">3.0</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktErr">lift/D+: Backpropagator unknown</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">op: 'pair?</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._rackpropagator/main..rkt)._error-unknown-transform))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-unknown-transform%29%29" class="RktValDef RktValLink" data-pltdoc="x">error-unknown-transform</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">op</span><span class="hspace">&nbsp;</span><span class="RktVar">op-name</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" class="RktStxLink" data-pltdoc="x">any</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">op</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">op-name</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Use as a value for <span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._current-unknown-transform%29%29" class="RktValLink" data-pltdoc="x">current-unknown-transform</a></span>.</div></p><p>The resulting procedure will be used as the reverse transform of
<span class="RktVar">op</span>.  It will unconditionally raise an error when called.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._rackpropagator/main..rkt)._error-unknown-proc-transform))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-unknown-proc-transform%29%29" class="RktValDef RktValLink" data-pltdoc="x">error-unknown-proc-transform</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">op</span><span class="hspace">&nbsp;</span><span class="RktVar">op-name</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28quote._~23~25kernel%29._procedure~3f%29%29" class="RktValLink" data-pltdoc="x">procedure?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">op</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">op-name</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Use as a value for <span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._current-unknown-transform%29%29" class="RktValLink" data-pltdoc="x">current-unknown-transform</a></span>.</div></p><p>The resulting procedure will be used as the reverse transform of
<span class="RktVar">op</span>.  It will raise an error when <span class="RktVar">op</span> is a procedure,
otherwise <span class="RktVar">op</span> is returned.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._rackpropagator/main..rkt)._error-non-zero-sensitivity-transform))"></a><span title="Provided from: rackpropagator | Package: rackpropagator-lib"><span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._error-non-zero-sensitivity-transform%29%29" class="RktValDef RktValLink" data-pltdoc="x">error-non-zero-sensitivity-transform</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">op</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">op-name</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28quote._~23~25kernel%29._procedure~3f%29%29" class="RktValLink" data-pltdoc="x">procedure?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">op</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">op-name</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" class="RktValLink" data-pltdoc="x">any/c</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Use as a value for <span class="RktSym"><a href="#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._current-unknown-transform%29%29" class="RktValLink" data-pltdoc="x">current-unknown-transform</a></span>.</div></p><p>The resulting procedure will be used as the reverse transform of
<span class="RktVar">op</span>.</p><p>When <span class="RktVar">op</span> is non-procedure value, <span class="RktVar">op</span> is returned.</p><p>When <span class="RktVar">op</span> is a procedure, attempt to construct a reverse
transform for it, whose primal is the result of evaluating the
procedure, and whose backpropagator raises an error when called,
unless <span class="RktPn">(</span><span class="RktSym"><a href="Linear_generic_interface.html#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._gen-zero%29%29" class="RktValLink" data-pltdoc="x">gen-zero</a></span><span class="RktPn">)</span> is passed (the result of the backpropagator
is then also <span class="RktPn">(</span><span class="RktSym"><a href="Linear_generic_interface.html#%28def._%28%28lib._rackpropagator%2Fmain..rkt%29._gen-zero%29%29" class="RktValLink" data-pltdoc="x">gen-zero</a></span><span class="RktPn">)</span>).</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Supported_Language.html" title="backward to &quot;1 Supported Language&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Rackpropagator: Reverse-mode automatic differentiation of Racket programs&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Linear_generic_interface.html" title="forward to &quot;3 Linear generic interface&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>